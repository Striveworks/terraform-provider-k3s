---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "k3s_server Resource - k3s"
subcategory: ""
description: |-
  Creates a k3s server resource. Only one of password or private_key can be passed.
  If ran in highly available mode, it is up to the consumers of this module to correctly implement the raft protocol and create an odd number of ha nodes.
---

# k3s_server (Resource)

Creates a k3s server resource. Only one of `password` or `private_key` can be passed.
If ran in highly available mode, it is up to the consumers of this module to correctly implement the raft protocol and create an odd number of ha nodes.

## Example Usage

```terraform
// Simple mode

variable "host" {
  type    = string
  default = ""
}

variable "user" {
  type = string
}

variable "private_key" {
  type      = string
  sensitive = true
}

variable "config" {
  type    = string
  default = null
}

resource "k3s_server" "main" {
  count       = var.host != "" ? 1 : 0
  host        = var.host
  user        = var.user
  private_key = var.private_key
  config      = var.config
}

// HA Server mode

variable "hosts" {
  type    = list(string)
  default = []
}


resource "k3s_server" "init" {
  count       = length(var.hosts) > 0 ? 1 : 0
  host        = var.hosts[0]
  user        = var.user
  private_key = var.private_key
  config      = var.config
  highly_available = {
    cluster_init = true
  }
}

resource "k3s_server" "join" {
  count = length(var.hosts) - 1

  host        = var.hosts[count.index + 1]
  user        = var.user
  private_key = var.private_key
  config      = var.config
  highly_available = {
    token  = k3s_server.init[0].token
    server = k3s_server.init[0].server
  }
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `host` (String) Hostname of the target server
- `user` (String) Username of the target server

### Optional

- `bin_dir` (String) Value of a path used to put the k3s binary
- `config` (String) K3s server config
- `highly_available` (Attributes) Run server node in highly available mode (see [below for nested schema](#nestedatt--highly_available))
- `password` (String, Sensitive) Username of the target server
- `port` (Number) Override default SSH port (22)
- `private_key` (String, Sensitive) Private ssh key value to be used in place of a password
- `registry` (String) K3s server registry

### Read-Only

- `active` (Boolean) The health of the server
- `id` (String) Id of the k3s server resource
- `kubeconfig` (String) KubeConfig for the cluster
- `server` (String) Server url  used for joining nodes to the cluster.
- `token` (String, Sensitive) Server token used for joining nodes to the cluster

<a id="nestedatt--highly_available"></a>
### Nested Schema for `highly_available`

Optional:

- `cluster_init` (Boolean) Node is the init node for the HA cluster
- `server` (String) Url of init node
- `token` (String, Sensitive) Server token used for joining nodes to the cluster

## Import

Import is supported using the following syntax:

The [`terraform import` command](https://developer.hashicorp.com/terraform/cli/commands/import) can be used, for example:

```shell
# Import with Password
tofu import k3s_server.main "host=192.168.10.1,user=ubuntu,password=$PASS"

# Import with key
tofu import k3s_server.main "host=192.168.10.1,user=ubuntu,private_key=$SSH_KEY"

# Ha Init Node
tofu import k3s_server.main "host=192.168.10.1,user=ubuntu,private_key=$SSH_KEY,cluster_init=true"

# Ha Join Node
tofu import k3s_server.main "host=192.168.10.1,user=ubuntu,private_key=$SSH_KEY,cluster_init=false"
```
